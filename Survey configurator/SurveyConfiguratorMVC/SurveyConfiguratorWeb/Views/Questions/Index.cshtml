@model IEnumerable<SurveyConfiguratorWeb.Models.QuestionViewModel>

@{
    ViewBag.Title = SharedResources.GlobalStrings.Questions;
    const string cAlertDivId = "alert";
}
<!-- place holder for any alerts or pop up messages-->
<div id="@cAlertDivId"></div>

<h2>@SharedResources.GlobalStrings.Questions</h2>
<p>
    @Html.ActionLink(SharedResources.GlobalStrings.AddQuestion, "Create", "Questions")
</p>
<span>
    @Html.Partial("PartialViews/_QuestionsList", Model)
</span>



@section Scripts {
    @Scripts.Render("~/bundles/jquery")
    <link rel="stylesheet" href="https://cdn.datatables.net/2.0.8/css/dataTables.dataTables.css" />
    <script src="https://cdn.datatables.net/2.0.8/js/dataTables.js"></script>
    <!--Reference the SignalR library. -->
    <script src="~/Scripts/jquery.signalR-2.2.2.min.js"></script>
    <!--Reference the autogenerated SignalR hub script. -->
    <script src="~/signalr/hubs"></script>
    <script>
        $(document).ready(async function () {
            //show alert popup if there's any
            if ('@TempData["Message"]') {
                $("#"+"@cAlertDivId").html("<div class='alert alert-danger'>"+"@TempData["Message"]"+"</div>")
                setTimeout(function () { $("#"+"@cAlertDivId").empty() }, 3500);
            }

            //data base check hub section
            let checker = $.connection.DataBaseCheckHub;

            checker.client.UpdateQuestionsList =  function () {
                $.ajax({
                    url: '@Url.Action("GetQuestionsListPartialView", "Questions")',
                    type: "GET",
                    success: function (pPartial) {
                        //show some notfication that the data has been updated
                        //re-render partial view with new data
                        $("span").empty();
                        $("span").html(pPartial);
                    },
                    error: function (xhr, status, error) {
                        console.log(xhr.responseText);
                    }
                })
            }

            $.connection.hub.start().done(function () {
                checker.server.StartCheck();
            }).fail(function (error) {
                console.error("an error occured while connecting to the server")
            })

        })
    </script>
}